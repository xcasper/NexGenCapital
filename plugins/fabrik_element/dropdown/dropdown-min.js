var FbDropdown=new Class({Extends:FbElement,initialize:function(b,a){this.plugin="fabrikdropdown";this.parent(b,a);if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}},watchAddToggle:function(){var h=this.getContainer();var f=h.getElement("div.addoption");var b=h.getElement(".toggle-addoption");if(this.mySlider){var g=f.clone();var e=h.getElement(".fabrikElement");f.getParent().destroy();e.adopt(g);f=h.getElement("div.addoption");f.setStyle("margin",0)}this.mySlider=new Fx.Slide(f,{duration:500});this.mySlider.hide();b.addEvent("click",function(a){a.stop();this.mySlider.toggle()}.bind(this))},watchAdd:function(){var a;if(this.options.allowadd===true&&this.options.editable!==false){var d=this.element.id;var b=this.getContainer();b.getElement("input[type=button]").addEvent("click",function(i){var c=b.getElement("input[name=addPicklistLabel]");var f=b.getElement("input[name=addPicklistValue]");var g=c.value;if(f){a=f.value}else{a=g}if(a===""||g===""){alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"))}else{var h=new Element("option",{selected:"selected",value:a}).set("text",g).inject(document.id(this.element.id));i.stop();if(f){f.value=""}c.value="";this.addNewOption(a,g);document.id(this.element.id).fireEvent("change",{stop:function(){}});if(this.mySlider){this.mySlider.toggle()}}}.bind(this))}},getValue:function(){if(!this.options.editable){return this.options.value}if(typeOf(this.element.get("value"))==="null"){return""}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(d){var c=[];if((typeOf(d)==="string")&&(JSON.validate(d))){d=JSON.decode(d)}if(typeOf(d)==="null"){d=[]}this.getElement();if(typeOf(this.element)==="null"){return}this.options.element=this.element.id;if(!this.options.editable){this.element.set("html","");var b=$H(this.options.data);d.each(function(e){this.element.innerHTML+=b.get(e)+"<br />"}.bind(this));return}c=this.element.getElements("option");if(typeOf(d)==="number"){d=d.toString()}for(var a=0;a<c.length;a++){if(d.indexOf(c[a].value)!==-1){c[a].selected=true}else{c[a].selected=false}}this.watchAdd()},cloned:function(a){if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}this.parent(a)}});