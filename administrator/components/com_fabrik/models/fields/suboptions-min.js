var Suboptions=new Class({Implements:[Options],options:{sub_initial_selection:[],j3:false},initialize:function(b,a){this.setOptions(a);this.element=document.id(this.options.id);if(typeOf(this.element)==="null"){if(confirm("oh dear - somethings gone wrong with loading the sub-options, do you want to reload?")){location.reload(true)}}this.watchButtons();this.counter=0;this.name=b;Object.each(this.options.sub_values,function(d,c){var e=Object.contains(this.options.sub_initial_selection,d)?"checked='checked'":"";this.addSubElement(d,this.options.sub_labels[c],e)}.bind(this));if(this.options.sub_values.length===0){this.addSubElement("","",false)}Joomla.submitbutton=function(c){if(c!=="element.cancel"&&!this.onSave()){return false}Joomla.submitform(c)}.bind(this)},watchButtons:function(){if(this.options.j3){this.element.addEvent('click:relay(a[data-button="addSuboption"])',function(b){b.preventDefault();this.addSubElement()}.bind(this));this.element.addEvent('click:relay(a[data-button="deleteSuboption"])',function(d,c){d.preventDefault();var b=this.element.getElements("tbody tr");if(b.length>1){c.getParent("tr").dispose()}}.bind(this));var a=this.element.getElements('a[data-button="addSuboption"]')}else{document.id("addSuboption").addEvent("click",function(b){this.addOption(b)}.bind(this))}},addOption:function(a){this.addSubElement();a.stop()},removeSubElement:function(a){var b=a.target.id.replace("sub_delete_","");if(document.id("sub_subElementBody").getElements("li").length>1){document.id("sub_content_"+b).dispose()}a.stop()},addJ3SubElement:function(g,c,e){var f=this._chx(g,e);var b=this._deleteButton();var d=new Element("tr").adopt([new Element("td",{"class":"handle subhandle"}),new Element("td",{width:"30%"}).adopt(this._valueField(g)),new Element("td",{width:"30%"}).adopt(this._labelField(c)),new Element("td",{width:"10%"}).set("html",f),b]);var a=this.element.getElement("tbody");a.adopt(d);if(!this.sortable){this.sortable=new Sortables(a,{handle:".subhandle"})}else{this.sortable.addItems(d)}this.counter++},_valueField:function(a){return new Element("input",{"class":"inputbox sub_values",type:"text",name:this.name+"[sub_values][]",id:"sub_value_"+this.counter,size:20,value:a,events:{change:function(b){fconsole("need to set this chb boxes value to the value field if selected, or set to blank")}}})},_labelField:function(a){return new Element("input",{"class":"inputbox sub_labels",type:"text",name:this.name+"[sub_labels][]",id:"sub_text_"+this.counter,size:20,value:a})},_chx:function(b,a){return'<input class="inputbox sub_initial_selection" type="checkbox" value="'+b+"\" name='"+this.name+"[sub_initial_selection][]' id=\"sub_checked_"+this.counter+'" '+a+" />"},_deleteButton:function(){return new Element("td",{width:"20%"}).set("html",this.options.delButton)},addSubElement:function(g,c,d){if(this.options.j3){return this.addJ3SubElement(g,c,d)}g=g?g:"";c=c?c:"";var f=this._chx(g,d);var b=this._deleteButton();b.getElement("a").id="sub_delete_"+this.counter;var a=new Element("li",{id:"sub_content_"+this.counter}).adopt([new Element("table",{width:"100%"}).adopt([new Element("tbody").adopt([new Element("tr").adopt([new Element("td",{rowspan:2,"class":"handle subhandle"}),new Element("td",{width:"30%"}).adopt(this._valueField(g)),new Element("td",{width:"30%"}).adopt(this._labelField(c)),new Element("td",{width:"10%"}).set("html",f),b])])])]);var e=document.id("sub_subElementBody").getElement("li");if(typeOf(e)!=="null"&&e.innerHTML===""){a.replaces(e)}else{a.inject(document.id("sub_subElementBody"))}document.id("sub_delete_"+this.counter).addEvent("click",function(h){this.removeSubElement(h)}.bind(this));if(!this.sortable){this.sortable=new Sortables("sub_subElementBody",{handle:".subhandle"})}else{this.sortable.addItems(a)}this.counter++},onSave:function(){var b=[],c=true,d=[],e=document.id("jform_params_dropdown_populate"),a=false;if(typeOf(e)!=="null"&&e.get("value")!==""){a=true}if(!a){$$(".sub_values").each(function(f){if(f.value===""){alert(Joomla.JText._("COM_FABRIK_SUBOPTS_VALUES_ERROR"));c=false}b.push(f.value)})}$$(".sub_initial_selection").each(function(f,g){f.value=b[g]});return c}});