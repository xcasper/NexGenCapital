// https://github.com/mkoryak/floatThead v0.7.4 - 10/30/12
(function(c){c.floatThead={defaults:{cellTag:"th",zIndex:1001,debounceResizeMs:1,scrollingTop:0,scrollingBottom:0,scrollContainer:function(){return c([])},floatTableClass:"floatThead-table"}};var k=c(window),w=0;c.fn.floatThead=function(l){if(_.isString(l))return this.filter("table").each(function(){var d=c(this).data("floatThead-attached");if(d&&_.isFunction(d[l]))d[l]()}),this;var d=c.extend({},c.floatThead.defaults,l);this.filter(":not(."+d.floatTableClass+")").each(function(){function l(){var a=
m.outerHeight(!0);u.outerHeight(a);x.outerHeight(a)}function y(){r=(_.isFunction(d.scrollingTop)?d.scrollingTop(a):d.scrollingTop)||0;G=(_.isFunction(d.scrollingBottom)?d.scrollingBottom(a):d.scrollingBottom)||0}function z(){var q=m.find("tr:first>"+d.cellTag),h=_.reduce(q,function(a,h){return a+parseInt(c(h).attr("colspan")||1,10)},0);if(h!=H){H=h;for(var g=[],i=[],b=0;b<h;b++)g.push("<td/>"),i.push("<col/>");u.html(g.join(""));A.html(i.join(""));x=u.find(">td");I=c.browser.msie&&7==parseFloat(c.browser.version)?
q:A.find("col")}q=function(){var f,g=a.find("tbody tr:first>td");if(g.length==h&&0<h){a.prepend(m);a.css(s);e.css(s);for(f=0;f<h;f++){var b=g.eq(f),d=b.outerWidth(!0);0==f&&(c.browser.mozilla&&(b.css("border-left-width")||b.css("border-right-width")))&&d--;I.eq(f).outerWidth(d);x.eq(f).outerWidth(d)}f=a.width();l();e.append(m);a.css(J);e.css(J);g=a.width();1<Math.abs(f-g)&&a.width(f)}else l(),e.append(m),a.css(s),e.css(s)};q();return q}function B(){var b=0<g.length,h=g.scrollTop(),d,i=0,e=j.height(),
f=a.offset(),l=null;b?(e=g.offset(),i=f.top-e.top+h):d=f.top-(r+e+G+v.horizontal);c.browser.msie&&b&&(g.scrollTop(0),l=a.offset().top,g.scrollTop(h));return function(){var e,j;e=k.scrollTop();h=g.scrollTop();b?(f=a.offset(),e=i>h?c.browser.msie?l-e-h:f.top-e:f.top+h-e-i,j=f.left+g.scrollLeft()-k.scrollLeft()):(j=a.outerHeight(),e=e>d+j?j+r-(e-d):f.top>e+r-h?f.top+h-e:r,j=f.left-k.scrollLeft());return{top:e,left:j}}}function K(){var c=null,b=null,d=null;return function(i,k,f){var m=g.scrollLeft();
if(c!=i.top||b!=i.left)j.css({top:i.top,left:i.left}),c=i.top,b=i.left;k&&(i=g.width()||a.outerWidth(),j.width(i-v.vertical),e.outerWidth(a.outerWidth()));f&&l();d!=m&&(j.scrollLeft(m),d=m)}}function C(){g.length&&(v.horizontal=g.width()<a.width()?D:0,v.vertical=g.height()<a.height()?D:0)}var a=c(this);if(a.data("floatThead-attached"))return!0;if(!a.is("table"))throw Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');var r,G,v={vertical:0,horizontal:0},D,b=0;if(c.browser.msie&&
7==parseFloat(c.browser.version))b=15;else{var L=c("<div/>").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1E3,left:-1E3}).prependTo("body").append("<div/>").find("div").css({width:"100%",height:200}),b=100-L.width();L.parent().remove()}D=b;var H=0,g=d.scrollContainer(a),m=a.find("thead:first"),e=c("<table/>"),A=c("<colgroup/>"),j=c('<div style="overflow: hidden;"></div>'),E=c("<thead/>"),u=c('<tr class="size-row"></tr>'),x=c([]),I=c([]);E.append(u);a.prepend(E);e.append(A);j.append(e);
e.attr("class",a.attr("class"));e.addClass(d.floatTableClass).css("margin",0);a.after(j);j.css({position:"fixed",marginTop:0,zIndex:d.zIndex});y();var J={"table-layout":"fixed"},s={"table-layout":a.css("tableLayout")||"auto"};C();var n=B(),t=K();z();t(n(),!0);var F=function(){t(n(),!1)},M=function(){y();C();z();n=B();t=K();t(n(),!0,!0)},p=_.debounce(function(){C();y();n=B();t(n(),!0);z()},1);k.bind("scroll.floatTHead",F);g.bind("scroll.floatTHead",F);var b=d.debounceResizeMs,N=M,O=k.width(),P=k.height(),
b=_.debounce(function(){if(c.browser.msie&&8>=parseFloat(c.browser.version)){var a=k.width(),b=k.height();if(O!=a||P!=b)O=a,P=b,N()}else N()},b);k.bind("resize.floatTHead",b);a.bind("reflow",p);a:{if(a.dataTableSettings)for(b=0;b<a.dataTableSettings.length;b++)if(a[0]==a.dataTableSettings[b].nTable){b=!0;break a}b=!1}b&&a.bind("filter",p).bind("sort",p).bind("page",p);a.data("floatThead-attached",{destroy:function(){a.css(s);E.replaceWith(m);a.unbind("reflow");p=M=F=function(){};g.unbind("scroll.floatTHead");
j.remove();a.data("floatThead-attached",!1);w--;0==w&&(k.unbind("scroll.floatTHead"),k.unbind("resize.floatTHead"))},reflow:function(){p()},setHeaderHeight:function(){l()}});w++});return this}})(jQuery);